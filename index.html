<!DOCTYPE HTML>
<html>
<head>
    <title>free rider - draw</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1, IE=9">

    <meta name="author" content="Ness & Pie42">
    <meta name="description" content="track editor v1.1">

    <meta name="format-detection" content="telephone=no">
    <meta name="HandheldFriendly" content="true" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="HandheldFriendly" content="true" />
    <meta name="robots" content="noindex,nofollow"w />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="Phaser App">
    <meta name="viewport" content="initial-scale=1 maximum-scale=1 user-scalable=0 minimal-ui" />
    <meta name="format-detection" content="telephone=no">
    
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link type="text/css" rel="stylesheet" href="app.css"></link>
    <script defer data-domain="freerider.app" src="https://plausible.io/js/script.js"></script>

</head>
<body>
    <div id="game-container"></div>
    
    <script src="scripts/manifest.js"></script>

    <script src="scripts/settings.js"></script>
    
    <script src="scripts/offlineeditor.js"></script>

    <script>
        function setTrackNameFromURL() {
            const hash = window.location.hash;
            if (hash) {
                let trackName = hash.substring(1);
                trackName = trackName.replace(/(\.\.\/)/g, '');
                if (trackName !== "1-4" && trackName !== "covid-19 dreamin" && trackName !== "demi-goddess demi-diety") {
                    trackName = trackName.replace(/-/g, ' ');
                }
                trackName = decodeURIComponent(trackName);
                GameSettings.trackName = trackName;
            }
        }
        setTrackNameFromURL();
    </script>

    <script>
    window.addEventListener('beforeunload', function (e) {
        const confirmationMessage = 'You have unsaved changes. Are you sure you want to leave without saving?';
        e.returnValue = confirmationMessage;
        return confirmationMessage;
    });
    </script>
    
    <script>
        window.addEventListener('message', function (event) {
            if (event.data.action === "linkClicked") {
                const url = event.data.url;

                try {
                    const fetchUrl = url;
                    fetch(fetchUrl)
                        .then((response) => {
                            if (!response.ok) {
                                throw new Error("No track ID found, loading as track code.");
                            }
                            return response.text();
                        })
                        .then((data) => {
                            if (data) {
                                console.log("Track data fetched:", data);
                                GameManager.command("import", data, true);
                                GameSettings.trackName = `${trackName}.txt`;
                            } else {
                                console.error("No track data found.");
                            }
                        })
                        .catch((error) => {
                            console.error("Primary fetch failed.", error);
                        });
                } catch (error) {
                    console.error("Error processing URL:", error);
                }
            }
        });
    </script>
    
    <!--
    <script>
        window !== window.parent ? GameSettings.beta = false : GameSettings.beta = true;
    </script>
    -->
</body>
</html>